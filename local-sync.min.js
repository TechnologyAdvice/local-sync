!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.LocalSync=t():e.LocalSync=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var a=r[n]={exports:{},id:n,loaded:!1};return e[n].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),c=r(1),l=n(c),s=function(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")},f=function(){var e=localStorage;try{var t=""+new Date;e.setItem("uid",t),e.getItem("uid")!==t&&(console.info("LocalSync: localStorage read/write is inconsistent, falling back to in-memory storage."),e=l.default),e.removeItem("uid")}catch(t){console.error(t),console.info("LocalSync: localStorage was not available, falling back to in-memory storage."),e=l.default}return{get:function(t){return e.getItem(t)},set:function(t,r){return e.setItem(t,r)},remove:function(t){return e.removeItem(t)},key:function(t){return e.key(t)},length:function(){return e.length}}}(),y=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(o(this,e),!(t instanceof Object))throw new Error('LocalSync "options" must be an object.');this._bucket=this._validateBucket(t.bucket||"default"),this._prefix=this._validatePrefix(t.prefix||"ls"),this._separator=this._validateSeparator(t.separator||".")}return u(e,[{key:"_mapKeys",value:function(e){for(var t=[],r=f.length()-1;r>=0;--r){var n=f.key(r);n.indexOf(this._fullBucket())!==-1&&t.unshift(e(this._parseKey(n)))}return t}},{key:"_mapBuckets",value:function(e){for(var t=[],r=f.length()-1;r>=0;--r){var n=f.key(r);n.indexOf(this._prefix)!==-1&&t.unshift(e(this._parseBucket(n)))}return t}},{key:"_fullBucket",value:function(){return[this._prefix,this._bucket].join(this._separator)}},{key:"_fullKey",value:function(e){return[this._fullBucket(),e].join(this._separator)}},{key:"_parseBucket",value:function(e){var t=s(this._prefix),r=s(this._separator),n=new RegExp(""+t+r+"(.*)"+r),a=e.match(n);return a&&a[1]||void 0}},{key:"_parseKey",value:function(e){var t=this._fullKey("fakeKey").replace("fakeKey",""),r=new RegExp(s(t));return e.replace(r,"")}},{key:"_validatePrefix",value:function(e){if("string"!=typeof e)throw new Error('LocalSync "prefix" must be a string.');if(e.indexOf(" ")!==-1)throw new Error('LocalSync "prefix" cannot contain spaces.');if(e.indexOf(this._separator)!==-1)throw new Error('LocalSync "prefix" cannot contain the separator "'+this._separator+'".');return e}},{key:"_validateSeparator",value:function(e){if("string"!=typeof e)throw new Error('LocalSync "separator" must be a string.');if(1!==e.length)throw new Error('LocalSync "separator" must be a single character.');return e}},{key:"_validateBucket",value:function(e){if("string"!=typeof e)throw new Error('LocalSync "bucket" must be a string.');if(e.indexOf(" ")!==-1)throw new Error('LocalSync "bucket" cannot contain spaces.');if(e.indexOf(this._separator)!==-1)throw new Error('LocalSync "bucket" cannot contain the separator "'+this._separator+'".');return e}},{key:"_validateKey",value:function(e){if("string"!=typeof e)throw new Error('LocalSync "key" parameter must be a string.');if(e.indexOf(this._separator)!==-1)throw new Error('LocalSync "key" cannot contain the separator "'+this._separator+'".');return e}},{key:"_validateValue",value:function(e){var t=[null,void 0,!0,0,"",[],{}],r=function(e){return Object.prototype.toString.call(e)};if(!t.some(function(t){return r(e)===r(t)}))throw new Error('LocalSync cannot store "value" of type '+r(e));return e}},{key:"setBucket",value:function(e){return this._bucket=this._validateBucket(e),this._bucket}},{key:"getBucket",value:function(){return this._bucket}},{key:"allBuckets",value:function(){return this._mapBuckets(function(e){return e})}},{key:"get",value:function(e){this._validateKey(e);var t=f.get(this._fullKey(e));try{return"undefined"===t?void 0:JSON.parse(t)}catch(e){throw console.error("Could not JSON.parse() value:",t),e}}},{key:"set",value:function(e,t){return this._validateKey(e),this._validateValue(t),f.set(this._fullKey(e),JSON.stringify(t)),this.get(e)}},{key:"put",value:function(e,t){return this._validateKey(e),this._validateValue(t),this.set(e,i({},this.get(e),t))}},{key:"remove",value:function(e){this._validateKey(e);var t=this.get(e);return f.remove(this._fullKey(e)),t}},{key:"clear",value:function(){var e=this;this.getAll().forEach(function(t){e.remove(Object.keys(t)[0])})}},{key:"keys",value:function(){return this._mapKeys(function(e){return e})}},{key:"values",value:function(){var e=this;return this._mapKeys(function(t){return e.get(t)})}},{key:"getAll",value:function(){var e=this;return this._mapKeys(function(t){return a({},t,e.get(t))})}}]),e}();t.default=y,e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={},n=0,a={getItem:function(e){return r[e]||null},setItem:function(e,t){"undefined"==typeof t?this.removeItem(e):(r[e]=t.toString(),n++)},removeItem:function(e){r[e]&&(delete r[e],n--)},key:function(e){return Object.keys(r)[e]||null},clear:function(){r={},n=0},get length(){return n}};t.default=a,e.exports=t.default}])});